<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Terminal</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=VT323&display=swap">
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" type="image/ico" href="/assets/terminal.ico">
</head>
<body>
    <main class="terminal" aria-label="Terminal">
        <section id="history" class="history" aria-live="polite"></section>
        <div id="input-line" class="input-line" contenteditable="true"
             spellcheck="false" role="textbox"
             aria-label="Command line. Type a command and press Enter."></div>
    </main>

    <script>
    (function() {
        const historyEl = document.getElementById('history');
        const inputEl = document.getElementById('input-line');

        // --- music player code ---
        const playlist = [
            {title: 'Nyan', path: '/assets/playlist/nyan.mp3'},
            {title: 'Antonymph', path: '/assets/playlist/antonymph.mp3'},
            {title: 'Brb', path: '/assets/playlist/brb.mp3'},
            {title: 'Spookwave', path: '/assets/playlist/spookwave.mp3'},

            // add songs here in format: {title: 'Song Title', path: '/assets/song.mp3'}
        ];
        let currentSongIndex = 0;
        let audio = new Audio();

        function playSong(index) {
            if (index >= 0 && index < playlist.length) {
                currentSongIndex = index;
                audio.src = playlist[currentSongIndex].path;
                audio.play();
                printToHistory(`Now playing: <strong>${playlist[currentSongIndex].title}</strong>`);
            }
        }

        function zigzagoonAnimation() {
            const imageUrl = '/assets/zigzagoon.png';
            const zImage = document.createElement('img');
            zImage.src = imageUrl;
            zImage.className = 'zigzagoon-animation';
            document.body.appendChild(zImage);

            setTimeout(() => {
                zImage.remove();
            }, 3000);
        }

        function bdayAnimation() {
            const imageUrl = '/assets/neil.jpeg' ;
            const bdayImage = document.createElement('img');
            bdayImage.src = imageUrl;
            bdayImage.className = 'bday-animation';
            document.body.appendChild(bdayImage);

            setTimeout(() => {
                bdayImage.remove();
            }, 4000);
        }

        const commands = {
            help: function() {
                printToHistory('Available commands:');
                printToHistory('<strong>apps</strong> â€“ view self hosted apps');
                printToHistory('<strong>socials</strong> â€“ view socials');
                printToHistory('<strong>message</strong> â€“ leave a message');
                printToHistory('<strong>minecraft</strong> â€“ view my servers');
                printToHistory('<strong>music</strong> â€“ play, pause, skip, or see now playing');
                printToHistory('<strong>old</strong> â€“ visit the old site');
                printToHistory('<strong>date</strong> â€“ display date');
                printToHistory('<strong>echo [text]</strong> â€“ print text to the terminal');
                printToHistory('<strong>neofetch</strong> â€“ display user information');
                printToHistory('<strong>tetris</strong> â€“ play Tetris');
                printToHistory('<strong>help</strong> â€“ show this help message');
                printToHistory('<strong>clear</strong> â€“ clear this terminal');
            },
            clear: function() {
                historyEl.innerHTML = '';
            },
            apps: function() {
                window.location.href = '/pages/apps.html';
            },
            socials: function() {
                window.location.href = '/pages/socials.html';
            },
            old: function() {
                window.location.href = 'https://old.coolbugs.win';
            },
            message: function() {
                window.location.href = '/pages/messages.html';
            },
            minecraft: function() {
                window.location.href = '/pages/dynmap.html';
            },
            echo: function(args) {
                printToHistory(escapeHtml(args));
            },
            date: function() {
                printToHistory(new Date().toLocaleString());
            },
            tetris: function() {
        window.location.href = '/pages/tetris.html';
            },
            music: function(args) {
                const parts = args.split(' ');
                const subCommand = parts[0].toLowerCase();

                switch (subCommand) {
                    case 'play':
                        if (audio.paused) {
                            audio.play();
                            printToHistory('Resumed playback.');
                        } else {
                            playSong(currentSongIndex);
                        }
                        break;
                    case 'pause':
                        audio.pause();
                        printToHistory('Playback paused.');
                        break;
                    case 'skip':
                        let nextSongIndex = (currentSongIndex + 1) % playlist.length;
                        playSong(nextSongIndex);
                        break;
                    case 'nowplaying':
                        if (!audio.paused) {
                            printToHistory(`Currently playing: <strong>${playlist[currentSongIndex].title}</strong>`);
                        } else {
                            printToHistory('Nothing is currently playing.');
                        }
                        break;
                    default:
                        printToHistory('Usage: music [play|pause|skip|nowplaying]');
                        break;
                }
            },
            neofetch: function() {
                const browserInfo = [
                '<strong>Vendor:</strong> ' + navigator.vendor,
                '<strong>User Agent:</strong> ' + navigator.userAgent,
                '<strong>Platform:</strong> ' + navigator.platform,
                '<strong>CPU Cores:</strong> ' + navigator.hardwareConcurrency,
                '<strong>Resolution:</strong> ' + screen.width + 'x' + screen.height,
                '<strong>Language:</strong> ' + navigator.language,
                '<strong>Cookies Enabled:</strong> ' + navigator.cookieEnabled,
            ];
                printToHistory(browserInfo.join('<br>'));
                },
            deer: function() {
                const deerImages = [
                    '/assets/deer1.png',
                    '/assets/deer2.png',
                    '/assets/deer3.webp',
                    '/assets/deer4.webp',
                    '/assets/deer5.png',
                    '/assets/deer6.png'
                ];
                for (let i = 0; i < 15; i++) {
                    setTimeout(() => {
                        const deer = document.createElement('img');
                        deer.className = 'deer';
                        deer.src = deerImages[Math.floor(Math.random() * deerImages.length)];
                        deer.style.top = Math.random() * 80 + 10 + '%';
                        deer.style.animationDuration = Math.random() * 5 + 5 + 's';
                        document.body.appendChild(deer);
                        setTimeout(() => {
                            deer.remove();
                        }, 10000);
                    }, i * 500);
                }
            },
            sal: function() {
                const audio = new Audio('/assets/sal.mp3');
                audio.play();
            }
        };

        const history = [];
        let historyIndex = -1;

        function printToHistory(message) {
            const line = document.createElement('div');
            line.classList.add('history-line');
            line.innerHTML = message;
            historyEl.appendChild(line);
            historyEl.scrollTop = historyEl.scrollHeight;
        }

        function executeCommand(cmd) {
            const trimmed = cmd.trim();
            if (!trimmed) return;
            printToHistory(`<span class="prompt">$</span> ${escapeHtml(trimmed)}`);
            history.push(trimmed);
            historyIndex = history.length;

            if (trimmed.toLowerCase() === 'zigzagoon i choose you') {
                zigzagoonAnimation();
                return;
            }
            if (trimmed === '04/13/06') {
                bdayAnimation();
                return;
            }

            const parts = trimmed.split(' ');
            const command = parts[0].toLowerCase();
            const args = parts.slice(1).join(' ');

            if (commands[command]) {
                commands[command](args);
            } else {
                printToHistory(`Command not recognized: <strong>${escapeHtml(command)}</strong>`);
            }
        }

        function escapeHtml(unsafe) {
            return unsafe.replace(/[&<"'>]/g, function(m) {
                return {
                    '&': '&amp;',
                    '<': '&lt;',
                    '"': '&quot;',
                    "'": '&#039;',
                    '>': '&gt;'
                }[m];
            });
        }

        window.addEventListener('load', () => {
            inputEl.focus();
            printToHistory('Welcome! Type <strong>help</strong> to see available commands ð‚‚');
        });

        inputEl.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                const commandText = inputEl.textContent;
                executeCommand(commandText);
                inputEl.textContent = '';
                return;
            }
            if (e.key === 'ArrowUp') {
                e.preventDefault();
                if (historyIndex > 0) {
                    historyIndex--;
                    inputEl.textContent = history[historyIndex];
                    placeCaretAtEnd(inputEl);
                }
                return;
            }
            if (e.key === 'ArrowDown') {
                e.preventDefault();
                if (historyIndex < history.length - 1) {
                    historyIndex++;
                    inputEl.textContent = history[historyIndex];
                } else {
                    historyIndex = history.length;
                    inputEl.textContent = '';
                }
                placeCaretAtEnd(inputEl);
                return;
            }
        });

        function placeCaretAtEnd(el) {
            const range = document.createRange();
            range.selectNodeContents(el);
            range.collapse(false);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
        }

    })();
    </script>
</body>
</html>