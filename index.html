<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Terminal</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=VT323&display=swap">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <main class="terminal" aria-label="Terminal">
        <section id="history" class="history" aria-live="polite"></section>
        <div id="input-line" class="input-line" contenteditable="true"
             spellcheck="false" role="textbox"
             aria-label="Command line. Type a command and press Enter."></div>
    </main>

    <script>
    (function() {
        const historyEl = document.getElementById('history');
        const inputEl = document.getElementById('input-line');
        const commands = {
            help: function() {
                printToHistory('Available commands:');
                printToHistory('<strong>apps</strong> – view self hosted apps');
                printToHistory('<strong>socials</strong> – view socials');
                printToHistory('<strong>message</strong> – leave a message');
                printToHistory('<strong>minecraft</strong> – view my servers');
                printToHistory('<strong>old</strong> – visit the old site');
                printToHistory('<strong>date</strong> – display date');
                printToHistory('<strong>echo [text]</strong> – print text to the terminal');
                printToHistory('<strong>neofetch</strong> – display user information');
                printToHistory('<strong>help</strong> – show this help message');
                printToHistory('<strong>clear</strong> – clear this terminal');
            },
            clear: function() {
                historyEl.innerHTML = '';
            },
            apps: function() {
                window.location.href = 'apps.html';
            },
            socials: function() {
                window.location.href = 'socials.html';
            },
            old: function() {
                window.location.href = 'https://old.coolbugs.win';
            },
            message: function() {
                window.location.href = 'messages.html';
            },
            minecraft: function() {
                window.location.href = 'dynmap.html';
            },
            echo: function(args) {
                printToHistory(escapeHtml(args));
            },
            date: function() {
                printToHistory(new Date().toLocaleString());
            },

            neofetch: function() {
                const browserInfo = [
                '<strong>Vendor:</strong> ' + navigator.vendor,
                '<strong>User Agent:</strong> ' + navigator.userAgent,
                '<strong>Platform:</strong> ' + navigator.platform,
                '<strong>CPU Cores:</strong> ' + navigator.hardwareConcurrency,
                '<strong>Resolution:</strong> ' + screen.width + 'x' + screen.height,
                '<strong>Language:</strong> ' + navigator.language,
                '<strong>Cookies Enabled:</strong> ' + navigator.cookieEnabled,
            ];
                printToHistory(browserInfo.join('<br>'));
                },
            deer: function() {
                const deerImages = [
                    '/assets/deer1.png',
                    '/assets/deer2.png',
                    '/assets/deer3.webp',
                    '/assets/deer4.webp',
                    '/assets/deer5.png',
                    '/assets/deer6.png'
                ];
                for (let i = 0; i < 15; i++) {
                    setTimeout(() => {
                        const deer = document.createElement('img');
                        deer.className = 'deer';
                        deer.src = deerImages[Math.floor(Math.random() * deerImages.length)];
                        deer.style.top = Math.random() * 80 + 10 + '%';
                        deer.style.animationDuration = Math.random() * 5 + 5 + 's';
                        document.body.appendChild(deer);
                        setTimeout(() => {
                            deer.remove();
                        }, 10000);
                    }, i * 500);
                }
            }
        };

        const history = [];
        let historyIndex = -1;

        function printToHistory(message) {
            const line = document.createElement('div');
            line.classList.add('history-line');
            line.innerHTML = message;
            historyEl.appendChild(line);
            historyEl.scrollTop = historyEl.scrollHeight;
        }

        function executeCommand(cmd) {
            const trimmed = cmd.trim();
            if (!trimmed) return;
            printToHistory(`<span class="prompt">$</span> ${escapeHtml(trimmed)}`);
            history.push(trimmed);
            historyIndex = history.length;

            const parts = trimmed.split(' ');
            const command = parts[0];
            const args = parts.slice(1).join(' ');

            if (commands[command]) {
                commands[command](args);
            } else {
                printToHistory(`Command not recognized: <strong>${escapeHtml(command)}</strong>`);
            }
        }

        function escapeHtml(unsafe) {
            return unsafe.replace(/[&<"'>]/g, function(m) {
                return {
                    '&': '&amp;',
                    '<': '&lt;',
                    '"': '&quot;',
                    "'": '&#039;',
                    '>': '&gt;'
                }[m];
            });
        }

        window.addEventListener('load', () => {
            inputEl.focus();
            printToHistory('Welcome! Type <strong>help</strong> to see available commands 𐂂');
        });

        inputEl.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                const commandText = inputEl.textContent;
                executeCommand(commandText);
                inputEl.textContent = '';
                return;
            }
            if (e.key === 'ArrowUp') {
                e.preventDefault();
                if (historyIndex > 0) {
                    historyIndex--;
                    inputEl.textContent = history[historyIndex];
                    placeCaretAtEnd(inputEl);
                }
                return;
            }
            if (e.key === 'ArrowDown') {
                e.preventDefault();
                if (historyIndex < history.length - 1) {
                    historyIndex++;
                    inputEl.textContent = history[historyIndex];
                } else {
                    historyIndex = history.length;
                    inputEl.textContent = '';
                }
                placeCaretAtEnd(inputEl);
                return;
            }
        });

        function placeCaretAtEnd(el) {
            const range = document.createRange();
            range.selectNodeContents(el);
            range.collapse(false);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
        }

    })();
    </script>
</body>
</html>